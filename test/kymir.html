<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É–ú–∏—Ä - –†–æ–±–æ—Ç (–ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É)</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        
        body {
            margin: 0;
            padding: 15px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #f0f0f0;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 2000px;
            margin: 0 auto;
        }
        
        .panel {
            background: rgba(30, 30, 46, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #0f3460, #533483);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .header h1 {
            margin: 0;
            font-size: clamp(1.2em, 4vw, 2em);
            color: white;
            flex: 1;
            min-width: 300px;
        }
        
        .macro-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        
        .macro-select {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #3498db;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            min-width: 200px;
            max-width: 100%;
            cursor: pointer;
            flex: 1;
        }
        
        .macro-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .macro-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }
        
        h2 {
            margin-top: 0;
            color: #3498db;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.3);
            font-size: clamp(1.1em, 3vw, 1.4em);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
        .editor-main-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 300px;
        }
        
        .code-editor-wrapper {
            flex: 1;
            border: 2px solid #34495e;
            border-radius: 8px;
            background: #1a1a2e;
            position: relative;
            overflow: hidden;
            min-height: 300px;
            max-height: 400px;
        }
        
        .code-editor {
            width: 100%;
            height: 100%;
            padding: 15px 15px 15px 50px;
            background: transparent;
            color: #e0e0e0;
            font-family: 'Consolas', monospace;
            font-size: clamp(12px, 2vw, 14px);
            line-height: 1.5;
            border: none;
            resize: none;
            outline: none;
            white-space: pre;
            tab-size: 2;
            overflow-y: auto;
        }
        
        .line-numbers {
            position: absolute;
            left: 0;
            top: 0;
            width: 45px;
            height: 100%;
            background: #16213e;
            color: #7f8c8d;
            text-align: right;
            padding: 15px 5px;
            font-family: 'Consolas', monospace;
            font-size: clamp(11px, 2vw, 13px);
            line-height: 1.5;
            border-right: 1px solid #34495e;
        }
        
        .current-line {
            background: rgba(243, 156, 18, 0.3) !important;
            color: #f39c12 !important;
            font-weight: bold;
        }
        
        /* –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–º–∞–Ω–¥ */
        .command-builder {
            background: rgba(44, 62, 80, 0.7);
            border-radius: 8px;
            padding: 15px;
        }
        
        .command-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .category {
            background: rgba(30, 30, 46, 0.8);
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .category h3 {
            margin-top: 0;
            color: #3498db;
            font-size: clamp(0.9em, 2vw, 1.1em);
            margin-bottom: 8px;
        }
        
        .command-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .cmd-btn {
            padding: 8px 12px;
            background: rgba(52, 152, 219, 0.3);
            border: 1px solid rgba(52, 152, 219, 0.5);
            border-radius: 5px;
            color: white;
            cursor: pointer;
            text-align: left;
            font-size: clamp(11px, 2vw, 13px);
            transition: all 0.2s;
            word-break: break-word;
        }
        
        .cmd-btn:hover {
            background: rgba(52, 152, 219, 0.5);
            transform: translateX(3px);
        }
        
        .cmd-btn.condition {
            background: rgba(46, 204, 113, 0.3);
            border-color: rgba(46, 204, 113, 0.5);
        }
        
        .cmd-btn.condition:hover {
            background: rgba(46, 204, 113, 0.5);
        }
        
        .cmd-btn.loop {
            background: rgba(155, 89, 182, 0.3);
            border-color: rgba(155, 89, 182, 0.5);
        }
        
        .cmd-btn.loop:hover {
            background: rgba(155, 89, 182, 0.5);
        }
        
        .cmd-btn.logical {
            background: rgba(230, 126, 34, 0.3);
            border-color: rgba(230, 126, 34, 0.5);
        }
        
        .cmd-btn.logical:hover {
            background: rgba(230, 126, 34, 0.5);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—è */
        .field-main-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .field-top-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .field-wrapper {
            width: 100%;
            min-height: 300px;
            border: 3px solid #34495e;
            border-radius: 10px;
            overflow: auto;
            background: #0f3460;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        #robot-field {
            display: grid;
            gap: 1px;
            background: #1a1a2e;
            min-width: min-content;
            min-height: min-content;
            padding: 5px;
        }
        
        .cell {
            background: #16213e;
            position: relative;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.05);
            min-width: 30px;
            min-height: 30px;
        }
        
        .cell:hover {
            background: #1e3a5f;
        }
        
        .cell.wall {
            background: #34495e;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.1) 10px, rgba(0,0,0,0.1) 20px);
        }
        
        .cell.painted {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            box-shadow: inset 0 0 10px rgba(241, 196, 15, 0.5);
        }
        
        .cell.executed {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        .robot {
            position: absolute;
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.3),
                inset 0 2px 10px rgba(255,255,255,0.2);
            z-index: 10;
        }
        
        .robot-direction {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 10px solid white;
            top: -5px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }
        
        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–º */
        .field-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            width: 100%;
        }
        
        .field-btn {
            padding: 10px;
            background: rgba(52, 73, 94, 0.7);
            border: 2px solid transparent;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: clamp(11px, 2vw, 13px);
            white-space: nowrap;
        }
        
        .field-btn:hover {
            background: rgba(52, 73, 94, 0.9);
            transform: translateY(-2px);
        }
        
        .field-btn.active {
            background: #3498db;
            border-color: #2980b9;
        }
        
        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .execution-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }
        
        .exec-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(12px, 2vw, 14px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: white;
            white-space: nowrap;
        }
        
        .exec-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .exec-btn.run {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        
        .exec-btn.step {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .exec-btn.stop {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .exec-btn.reset {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .exec-btn.clear {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            background: rgba(30, 30, 46, 0.7);
            padding: 15px;
            border-radius: 10px;
        }
        
        .stat-card {
            background: rgba(44, 62, 80, 0.5);
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .stat-title {
            color: #95a5a6;
            font-size: clamp(10px, 2vw, 12px);
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: clamp(1.2em, 3vw, 1.5em);
            font-weight: bold;
            color: #3498db;
        }
        
        .status-bar {
            background: rgba(44, 62, 80, 0.8);
            padding: 12px 15px;
            border-radius: 10px;
            font-family: monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid #3498db;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2ecc71;
        }
        
        .status-dot.error {
            background: #e74c3c;
            animation: pulseError 1s infinite;
        }
        
        .status-dot.running {
            background: #f39c12;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulseError {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (min-width: 1024px) {
            .field-top-section {
                flex-direction: row;
            }
            
            .field-wrapper {
                flex: 2;
                min-height: 400px;
            }
            
            .field-controls {
                flex: 1;
                grid-template-columns: repeat(2, 1fr);
                align-content: start;
            }
            
            .code-editor-wrapper {
                max-height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .panel {
                padding: 15px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                min-width: 100%;
                text-align: center;
                font-size: 1.3em;
            }
            
            .macro-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .macro-select, .macro-btn {
                width: 100%;
            }
            
            .command-categories {
                grid-template-columns: 1fr;
            }
            
            .field-controls, .execution-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-bar {
                flex-direction: column;
                text-align: center;
                gap: 8px;
            }
            
            .status-indicator {
                min-width: 100%;
                justify-content: center;
            }
            
            .cell {
                min-width: 25px;
                min-height: 25px;
            }
        }
        
        @media (max-width: 480px) {
            .field-controls, .execution-controls {
                grid-template-columns: 1fr;
            }
            
            .stats-panel {
                grid-template-columns: 1fr;
            }
            
            .cell {
                min-width: 20px;
                min-height: 20px;
            }
            
            .code-editor {
                padding: 12px 12px 12px 40px;
            }
            
            .line-numbers {
                width: 35px;
                padding: 12px 3px;
            }
        }
        
        @media (min-width: 2000px) {
            .app-container {
                max-width: 95vw;
            }
            
            .cell {
                min-width: 40px;
                min-height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="panel header">
            <h1>ü§ñ –°—Ä–µ–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è "–†–æ–±–æ—Ç" (–ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ö—É–ú–∏—Ä)</h1>
            <div class="macro-controls">
                <select class="macro-select" id="macro-select">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–∫—Ä–æ—Å --</option>
                    <option value="move_right">‚Üí –î–≤–∏–≥–∞—Ç—å—Å—è –≤–ø—Ä–∞–≤–æ –¥–æ —Å—Ç–µ–Ω—ã</option>
                    <option value="smart_maze">üß† –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤—ã—Ö–æ–¥–∞</option>
                    <option value="explore_maze">üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ª–∞–±–∏—Ä–∏–Ω—Ç</option>
                    <option value="draw_square">‚¨ú –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç</option>
                    <option value="perimeter">üî≤ –û–±–æ–π—Ç–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä</option>
                    <option value="spiral">üåÄ –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Å–ø–∏—Ä–∞–ª—å</option>
                    <option value="right_hand">ü§ö –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∞–≤–æ–π —Ä—É–∫–∏</option>
                    <option value="backtrack">‚Ü©Ô∏è –ü–æ–∏—Å–∫ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º</option>
                    <option value="return_home">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –Ω–∞—á–∞–ª–æ</option>
                    <option value="clean_all">üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–ª–µ—Ç–∫–∏</option>
                </select>
                <button class="macro-btn" id="apply-macro">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–∫—Ä–æ—Å</button>
            </div>
        </div>
        
        <!-- –†–ï–î–ê–ö–¢–û–† –°–í–ï–†–•–£ -->
        <div class="panel editor-main-container">
            <h2>üìù –†–µ–¥–∞–∫—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞ (20 —Å—Ç—Ä–æ–∫)</h2>
            <div class="code-editor-wrapper">
                <div class="line-numbers" id="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</div>
                <textarea class="code-editor" id="algorithm-code" spellcheck="false" rows="20">–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –û—Å–Ω–æ–≤–Ω–∞—è–ü—Ä–æ–≥—Ä–∞–º–º–∞
–Ω–∞—á
  –Ω—Ü –ø–æ–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–ø—Ä–∞–≤–æ
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
–∫–æ–Ω</textarea>
            </div>
            
            <div class="command-builder">
                <h3 style="margin-top: 0; color: #3498db;">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–º–∞–Ω–¥ (–ø–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ö—É–ú–∏—Ä)</h3>
                <div class="command-categories">
                    <div class="category">
                        <h3>üîß –î–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" data-cmd="–≤–≤–µ—Ä—Ö">–≤–≤–µ—Ä—Ö</button>
                            <button class="cmd-btn" data-cmd="–≤–Ω–∏–∑">–≤–Ω–∏–∑</button>
                            <button class="cmd-btn" data-cmd="–≤–ª–µ–≤–æ">–≤–ª–µ–≤–æ</button>
                            <button class="cmd-btn" data-cmd="–≤–ø—Ä–∞–≤–æ">–≤–ø—Ä–∞–≤–æ</button>
                            <button class="cmd-btn" data-cmd="–∑–∞–∫—Ä–∞—Å–∏—Ç—å">–∑–∞–∫—Ä–∞—Å–∏—Ç—å</button>
                            <button class="cmd-btn" data-cmd="–æ—Å–≤–æ–±–æ–¥–∏—Ç—å">–æ—Å–≤–æ–±–æ–¥–∏—Ç—å</button>
                        </div>
                    </div>
                    
                    <div class="category">
                        <h3>üîÑ –¶–∏–∫–ª—ã</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn loop" data-cmd="–Ω—Ü –ø–æ–∫–∞ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ">–Ω—Ü –ø–æ–∫–∞ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ</button>
                            <button class="cmd-btn loop" data-cmd="–Ω—Ü –ø–æ–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ">–Ω—Ü –ø–æ–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ</button>
                            <button class="cmd-btn loop" data-cmd="–Ω—Ü –ø–æ–∫–∞ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ">–Ω—Ü –ø–æ–∫–∞ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ</button>
                            <button class="cmd-btn loop" data-cmd="–Ω—Ü –ø–æ–∫–∞ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ">–Ω—Ü –ø–æ–∫–∞ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ</button>
                            <button class="cmd-btn loop" data-cmd="–Ω—Ü –ø–æ–∫–∞ –ù–ï –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞">–Ω—Ü –ø–æ–∫–∞ –ù–ï –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞</button>
                            <button class="cmd-btn loop" data-cmd="–Ω—Ü 5 —Ä–∞–∑">–Ω—Ü 5 —Ä–∞–∑</button>
                            <button class="cmd-btn loop" data-cmd="–∫—Ü">–∫—Ü</button>
                        </div>
                    </div>
                    
                    <div class="category">
                        <h3>‚ùì –£—Å–ª–æ–≤–∏—è</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn condition" data-cmd="–µ—Å–ª–∏ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ">–µ—Å–ª–∏ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ</button>
                            <button class="cmd-btn condition" data-cmd="–µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ">–µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ</button>
                            <button class="cmd-btn condition" data-cmd="–µ—Å–ª–∏ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ">–µ—Å–ª–∏ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ</button>
                            <button class="cmd-btn condition" data-cmd="–µ—Å–ª–∏ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ">–µ—Å–ª–∏ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ</button>
                            <button class="cmd-btn condition" data-cmd="–µ—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞ —Ç–æ">–µ—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞ —Ç–æ</button>
                            <button class="cmd-btn condition" data-cmd="–µ—Å–ª–∏ –ù–ï –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞ —Ç–æ">–µ—Å–ª–∏ –ù–ï –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞ —Ç–æ</button>
                            <button class="cmd-btn condition" data-cmd="–≤—Å–µ">–≤—Å–µ</button>
                            <button class="cmd-btn condition" data-cmd="–∏–Ω–∞—á–µ">–∏–Ω–∞—á–µ</button>
                        </div>
                    </div>
                    
                    <div class="category">
                        <h3>üîÄ –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn logical" data-cmd="–ù–ï ">–ù–ï (–æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ)</button>
                            <button class="cmd-btn logical" data-cmd="–ò ">–ò (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò)</button>
                            <button class="cmd-btn logical" data-cmd="–ò–õ–ò ">–ò–õ–ò (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–û–õ–ï –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ù–ò–ó–£ -->
        <div class="panel field-main-container">
            <h2>üó∫Ô∏è –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ (20√ó15)</h2>
            <div class="field-top-section">
                <div class="field-wrapper">
                    <div id="robot-field"></div>
                </div>
                
                <div class="field-controls">
                    <button class="field-btn active" data-mode="wall">üß± –°—Ç–µ–Ω–∞</button>
                    <button class="field-btn" data-mode="paint">üé® –ó–∞–∫—Ä–∞—Å–∏—Ç—å</button>
                    <button class="field-btn" data-mode="robot">ü§ñ –†–æ–±–æ—Ç</button>
                    <button class="field-btn" data-mode="clear">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
                    <button class="field-btn" id="btn-add-walls">‚ûï –°–ª—É—á–∞–π–Ω—ã–µ —Å—Ç–µ–Ω—ã</button>
                    <button class="field-btn" id="btn-clear-all">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
                    <button class="field-btn" id="btn-maze">üé≤ –°–ª–æ–∂–Ω—ã–π –ª–∞–±–∏—Ä–∏–Ω—Ç</button>
                    <button class="field-btn" id="btn-test-field">üß™ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ</button>
                </div>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="panel execution-controls">
            <button class="exec-btn run" id="btn-run">
                <span>‚ñ∂</span> –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
            </button>
            <button class="exec-btn step" id="btn-step">
                <span>‚è≠</span> –®–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            </button>
            <button class="exec-btn stop" id="btn-stop" disabled>
                <span>‚èπ</span> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
            </button>
            <button class="exec-btn reset" id="btn-reset">
                <span>üîÑ</span> –°–±—Ä–æ—Å–∏—Ç—å —Ä–æ–±–æ—Ç–∞
            </button>
            <button class="exec-btn clear" id="btn-clear-code">
                <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–¥
            </button>
            <button class="exec-btn" id="btn-save-code">
                <span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button class="exec-btn" id="btn-validate">
                <span>‚úì</span> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
            </button>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="panel stats-panel">
            <div class="stat-card">
                <div class="stat-title">–ü–æ–∑–∏—Ü–∏—è —Ä–æ–±–æ—Ç–∞</div>
                <div class="stat-value" id="robot-position">(9,7)</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∫–æ–º–∞–Ω–¥</div>
                <div class="stat-value" id="commands-executed">13</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">–ó–∞–∫—Ä–∞—à–µ–Ω–æ –∫–ª–µ—Ç–æ–∫</div>
                <div class="stat-value" id="cells-painted">6</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                <div class="stat-value" id="execution-time">5.7—Å</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞</div>
                <div class="stat-value" id="current-line">7</div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
        <div class="panel status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">–ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</span>
            </div>
            <div id="debug-info">–°–æ—Å—Ç–æ—è–Ω–∏–µ: –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | –®–∞–≥: 0 | –¶–∏–∫–ª–æ–≤: 0</div>
        </div>
    </div>

    <script>
        // ==================== –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================
        const State = {
            field: [],
            robot: { x: 9, y: 7, direction: 'right' },
            fieldMode: 'wall',
            fieldWidth: 20,
            fieldHeight: 15,
            
            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
            isRunning: false,
            isStepping: false,
            currentLine: 0,
            programLines: [],
            executionStack: [],
            loopCounters: new Map(),
            waitingForInput: false,
            stepCount: 0,
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            stats: {
                commandsExecuted: 13,
                startTime: 0,
                cellsPainted: 6,
                loopsCompleted: 0,
                conditionsChecked: 0
            }
        };

        // ==================== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ú–ê–ö–†–û–°–´ (—Ä–∞–±–æ—á–∏–µ –≤–µ—Ä—Å–∏–∏) ====================
        const MACROS = {
            move_right: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –î–≤–∏–≥–∞—Ç—å—Å—è–í–ø—Ä–∞–≤–æ
–Ω–∞—á
  –Ω—Ü –ø–æ–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–ø—Ä–∞–≤–æ
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
–∫–æ–Ω`,

            smart_maze: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –£–º–Ω—ã–π–ü–æ–∏—Å–∫–í—ã—Ö–æ–¥–∞
–Ω–∞—á
  ! –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –≤ –ª–∞–±–∏—Ä–∏–Ω—Ç–µ
  –Ω—Ü 100 —Ä–∞–∑
    –µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
      –≤–ø—Ä–∞–≤–æ
      –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –∏–Ω–∞—á–µ
      –µ—Å–ª–∏ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
        –≤–Ω–∏–∑
        –∑–∞–∫—Ä–∞—Å–∏—Ç—å
      –∏–Ω–∞—á–µ
        –µ—Å–ª–∏ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
          –≤–ª–µ–≤–æ
          –∑–∞–∫—Ä–∞—Å–∏—Ç—å
        –∏–Ω–∞—á–µ
          –µ—Å–ª–∏ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
            –≤–≤–µ—Ä—Ö
            –∑–∞–∫—Ä–∞—Å–∏—Ç—å
          –≤—Å–µ
        –≤—Å–µ
      –≤—Å–µ
    –≤—Å–µ
  –∫—Ü
–∫–æ–Ω`,

            explore_maze: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å–õ–∞–±–∏—Ä–∏–Ω—Ç
–Ω–∞—á
  –Ω—Ü 100 —Ä–∞–∑
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
      –≤–ø—Ä–∞–≤–æ
    –∏–Ω–∞—á–µ
      –µ—Å–ª–∏ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
        –≤–Ω–∏–∑
      –∏–Ω–∞—á–µ
        –µ—Å–ª–∏ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
          –≤–ª–µ–≤–æ
        –∏–Ω–∞—á–µ
          –µ—Å–ª–∏ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
            –≤–≤–µ—Ä—Ö
          –≤—Å–µ
        –≤—Å–µ
      –≤—Å–µ
    –≤—Å–µ
  –∫—Ü
–∫–æ–Ω`,

            draw_square: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –ö–≤–∞–¥—Ä–∞—Ç
–Ω–∞—á
  ! –†–∏—Å—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç 4x4
  –Ω—Ü 4 —Ä–∞–∑
    –≤–ø—Ä–∞–≤–æ
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
  –Ω—Ü 4 —Ä–∞–∑
    –≤–Ω–∏–∑
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
  –Ω—Ü 4 —Ä–∞–∑
    –≤–ª–µ–≤–æ
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
  –Ω—Ü 4 —Ä–∞–∑
    –≤–≤–µ—Ä—Ö
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
–∫–æ–Ω`,

            perimeter: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –ü–µ—Ä–∏–º–µ—Ç—Ä
–Ω–∞—á
  ! –û–±—Ö–æ–¥–∏–º –ø–µ—Ä–∏–º–µ—Ç—Ä
  –Ω—Ü –ø–æ–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–ø—Ä–∞–≤–æ
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
  –Ω—Ü –ø–æ–∫–∞ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–Ω–∏–∑
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
  –Ω—Ü –ø–æ–∫–∞ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–ª–µ–≤–æ
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
  –Ω—Ü –ø–æ–∫–∞ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–≤–µ—Ä—Ö
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
  –∫—Ü
–∫–æ–Ω`,

            spiral: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –°–ø–∏—Ä–∞–ª—å
–Ω–∞—á
  ! –†–∏—Å—É–µ–º —Å–ø–∏—Ä–∞–ª—å
  –Ω—Ü 3 —Ä–∞–∑
    –Ω—Ü 4 —Ä–∞–∑
      –≤–ø—Ä–∞–≤–æ
      –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –∫—Ü
    –Ω—Ü 4 —Ä–∞–∑
      –≤–Ω–∏–∑
      –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –∫—Ü
    –Ω—Ü 4 —Ä–∞–∑
      –≤–ª–µ–≤–æ
      –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –∫—Ü
    –Ω—Ü 4 —Ä–∞–∑
      –≤–≤–µ—Ä—Ö
      –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –∫—Ü
  –∫—Ü
–∫–æ–Ω`,

            right_hand: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –ü—Ä–∞–≤–∞—è–†—É–∫–∞
–Ω–∞—á
  ! –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∞–≤–æ–π —Ä—É–∫–∏
  –Ω—Ü 80 —Ä–∞–∑
    –µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
      –≤–ø—Ä–∞–≤–æ
      –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –∏–Ω–∞—á–µ
      –µ—Å–ª–∏ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
        –≤–≤–µ—Ä—Ö
        –∑–∞–∫—Ä–∞—Å–∏—Ç—å
      –∏–Ω–∞—á–µ
        –µ—Å–ª–∏ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
          –≤–ª–µ–≤–æ
          –∑–∞–∫—Ä–∞—Å–∏—Ç—å
        –∏–Ω–∞—á–µ
          –µ—Å–ª–∏ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
            –≤–Ω–∏–∑
            –∑–∞–∫—Ä–∞—Å–∏—Ç—å
          –≤—Å–µ
        –≤—Å–µ
      –≤—Å–µ
    –≤—Å–µ
  –∫—Ü
–∫–æ–Ω`,

            backtrack: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –ü–æ–∏—Å–∫–°–í–æ–∑–≤—Ä–∞—Ç–æ–º
–Ω–∞—á
  ! –ü–æ–∏—Å–∫ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º
  –Ω—Ü 100 —Ä–∞–∑
    –∑–∞–∫—Ä–∞—Å–∏—Ç—å
    –µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
      –≤–ø—Ä–∞–≤–æ
    –∏–Ω–∞—á–µ
      –µ—Å–ª–∏ —Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
        –≤–Ω–∏–∑
      –∏–Ω–∞—á–µ
        –µ—Å–ª–∏ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
          –≤–ª–µ–≤–æ
        –∏–Ω–∞—á–µ
          –µ—Å–ª–∏ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ —Ç–æ
            –≤–≤–µ—Ä—Ö
          –≤—Å–µ
        –≤—Å–µ
      –≤—Å–µ
    –≤—Å–µ
  –∫—Ü
–∫–æ–Ω`,

            return_home: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –í–µ—Ä–Ω—É—Ç—å—Å—è–í–ù–∞—á–∞–ª–æ
–Ω–∞—á
  ! –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ª–µ–≤–æ–π —Å—Ç–µ–Ω–µ
  –Ω—Ü –ø–æ–∫–∞ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–ª–µ–≤–æ
  –∫—Ü
  ! –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≤–µ—Ä—Ö–Ω–µ–π —Å—Ç–µ–Ω–µ
  –Ω—Ü –ø–æ–∫–∞ —Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ
    –≤–≤–µ—Ä—Ö
  –∫—Ü
–∫–æ–Ω`,

            clean_all: `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –û—á–∏—Å—Ç–∏—Ç—å–ü–æ–ª–µ
–Ω–∞—á
  ! –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–ª–µ—Ç–∫–∞–º
  –Ω—Ü 7 —Ä–∞–∑
    –Ω—Ü –ø–æ–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
      –≤–ø—Ä–∞–≤–æ
    –∫—Ü
    –≤–Ω–∏–∑
    –Ω—Ü –ø–æ–∫–∞ —Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ
      –≤–ª–µ–≤–æ
    –∫—Ü
    –≤–Ω–∏–∑
  –∫—Ü
–∫–æ–Ω`
        };

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–õ–Ø ====================
        function initField() {
            const fieldEl = document.getElementById('robot-field');
            fieldEl.innerHTML = '';
            
            fieldEl.style.gridTemplateColumns = `repeat(${State.fieldWidth}, 1fr)`;
            fieldEl.style.gridTemplateRows = `repeat(${State.fieldHeight}, 1fr)`;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞ –ø–æ–ª—è
            State.field = [];
            for (let y = 0; y < State.fieldHeight; y++) {
                State.field[y] = [];
                for (let x = 0; x < State.fieldWidth; x++) {
                    const isBorder = (x === 0 || x === State.fieldWidth-1 || y === 0 || y === State.fieldHeight-1);
                    
                    State.field[y][x] = {
                        wall: isBorder,
                        painted: false,
                        robot: false
                    };
                    
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (State.field[y][x].wall) cell.classList.add('wall');
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    cell.addEventListener('click', () => handleCellClick(x, y));
                    cell.addEventListener('mouseenter', (e) => {
                        if (e.buttons === 1) handleCellClick(x, y);
                    });
                    
                    fieldEl.appendChild(cell);
                }
            }
            
            // –†–∞–∑–º–µ—â–∞–µ–º —Ä–æ–±–æ—Ç–∞
            placeRobot(State.robot.x, State.robot.y, State.robot.direction);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫—Ä–∞—à–µ–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ (–∏–∑ –ø—Ä–∏–º–µ—Ä–∞)
            for (let i = 2; i < 8; i++) {
                State.field[7][i].painted = true;
            }
            
            updateFieldDisplay();
            updateStats();
        }

        function handleCellClick(x, y) {
            if (State.isRunning) return;
            
            const cell = State.field[y][x];
            
            switch (State.fieldMode) {
                case 'wall':
                    if (!cell.robot) {
                        cell.wall = !cell.wall;
                    }
                    break;
                case 'paint':
                    cell.painted = !cell.painted;
                    break;
                case 'robot':
                    if (!cell.wall) {
                        placeRobot(x, y, State.robot.direction);
                    }
                    break;
                case 'clear':
                    cell.wall = false;
                    cell.painted = false;
                    break;
            }
            
            updateFieldDisplay();
            updateStats();
        }

        function placeRobot(x, y, dir) {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–∑–∏—Ü–∏—é
            if (State.robot.x !== undefined && State.robot.y !== undefined) {
                State.field[State.robot.y][State.robot.x].robot = false;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
            State.robot = { x, y, direction: dir };
            State.field[y][x].robot = true;
        }

        function updateFieldDisplay() {
            document.querySelectorAll('.cell').forEach(cell => {
                const x = parseInt(cell.dataset.x);
                const y = parseInt(cell.dataset.y);
                const cellData = State.field[y][x];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã
                cell.className = 'cell';
                if (cellData.wall) cell.classList.add('wall');
                if (cellData.painted) cell.classList.add('painted');
                
                // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                cell.innerHTML = '';
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–æ–±–æ—Ç–∞
                if (cellData.robot) {
                    const robotEl = document.createElement('div');
                    robotEl.className = 'robot';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    const dirEl = document.createElement('div');
                    dirEl.className = 'robot-direction';
                    
                    const rotations = {
                        'up': 0,
                        'right': 90,
                        'down': 180,
                        'left': 270
                    };
                    dirEl.style.transform = `rotate(${rotations[State.robot.direction]}deg)`;
                    
                    robotEl.appendChild(dirEl);
                    cell.appendChild(robotEl);
                }
            });
        }

        // ==================== –†–ï–î–ê–ö–¢–û–† –ê–õ–ì–û–†–ò–¢–ú–ê ====================
        function initEditor() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫
            updateLineNumbers();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∫–æ–º–∞–Ω–¥
            document.querySelectorAll('.cmd-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const command = this.dataset.cmd;
                    insertCommand(command);
                });
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫
            document.getElementById('algorithm-code').addEventListener('input', updateLineNumbers);
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–µ —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
            const editor = document.getElementById('algorithm-code');
            const lineNumbers = document.getElementById('line-numbers');
            
            editor.addEventListener('scroll', () => {
                lineNumbers.scrollTop = editor.scrollTop;
            });
        }

        function updateLineNumbers() {
            const editor = document.getElementById('algorithm-code');
            const lineNumbers = document.getElementById('line-numbers');
            
            const lines = editor.value.split('\n').length;
            const visibleLines = Math.max(20, lines);
            
            let numbersHTML = '';
            for (let i = 1; i <= visibleLines; i++) {
                const className = i === State.currentLine + 1 ? 'line-number current-line' : 'line-number';
                numbersHTML += `<div class="${className}">${i}</div>`;
            }
            
            lineNumbers.innerHTML = numbersHTML;
            lineNumbers.style.height = editor.scrollHeight + 'px';
        }

        function insertCommand(command) {
            const editor = document.getElementById('algorithm-code');
            const cursorPos = editor.selectionStart;
            const textBefore = editor.value.substring(0, cursorPos);
            const textAfter = editor.value.substring(cursorPos);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏
            const lines = editor.value.substring(0, cursorPos).split('\n');
            const currentLine = lines[lines.length - 1];
            const indent = currentLine.match(/^(\s*)/)[0].length;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç—Å—Ç—É–ø–æ–º
            let commandToInsert = command;
            if (command.startsWith('–Ω—Ü') || command.startsWith('–µ—Å–ª–∏')) {
                commandToInsert = '  '.repeat(indent) + command;
            } else if (command === '–∫—Ü' || command === '–≤—Å–µ' || command === '–∏–Ω–∞—á–µ') {
                commandToInsert = '  '.repeat(Math.max(0, indent - 2)) + command;
            } else {
                commandToInsert = '  '.repeat(indent) + command;
            }
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É
            editor.value = textBefore + commandToInsert + '\n' + textAfter;
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫—É—Ä—Å–æ—Ä
            const newPos = cursorPos + commandToInsert.length + 1;
            editor.selectionStart = editor.selectionEnd = newPos;
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
            editor.focus();
            
            updateLineNumbers();
        }

        // ==================== –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï –ü–†–û–ì–†–ê–ú–ú–´ ====================
        async function executeProgram() {
            if (State.isRunning) return;
            
            const code = document.getElementById('algorithm-code').value;
            State.programLines = code.split('\n').map(line => line.trim());
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
            if (!validateProgram()) return;
            
            State.isRunning = true;
            State.isStepping = false;
            State.currentLine = 0;
            State.executionStack = [];
            State.loopCounters.clear();
            State.stats = {
                commandsExecuted: 0,
                startTime: Date.now(),
                cellsPainted: 0,
                loopsCompleted: 0,
                conditionsChecked: 0
            };
            State.stepCount = 0;
            
            updateStatus('running', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ...');
            document.getElementById('btn-stop').disabled = false;
            document.getElementById('btn-run').disabled = true;
            document.getElementById('btn-step').disabled = true;
            updateLineNumbers();
            updateStats();
            
            try {
                // –ò—â–µ–º –Ω–∞—á–∞–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã (–ø–æ—Å–ª–µ '–Ω–∞—á')
                let startIndex = State.programLines.findIndex(line => line.includes('–Ω–∞—á'));
                if (startIndex !== -1) {
                    State.currentLine = startIndex + 1;
                }
                
                while (State.isRunning && State.currentLine < State.programLines.length) {
                    await executeCurrentLine();
                    State.stepCount++;
                    updateDebugInfo();
                    updateLineNumbers();
                    await delay(200); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
                }
                
                if (State.isRunning) {
                    State.stats.executionTime = (Date.now() - State.stats.startTime) / 1000;
                    updateStatus('success', `‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${State.stats.executionTime.toFixed(1)}—Å`);
                }
            } catch (error) {
                updateStatus('error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
            
            State.isRunning = false;
            document.getElementById('btn-stop').disabled = true;
            document.getElementById('btn-run').disabled = false;
            document.getElementById('btn-step').disabled = false;
            updateStats();
        }

        // ==================== –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ü–û–®–ê–ì–û–í–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï ====================
        async function executeStep() {
            if (State.isRunning && !State.isStepping) return;
            
            const code = document.getElementById('algorithm-code').value;
            State.programLines = code.split('\n').map(line => line.trim());
            
            // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ–º —à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
            if (!State.isStepping) {
                if (!validateProgram()) return;
                
                State.isRunning = true;
                State.isStepping = true;
                State.currentLine = 0;
                State.executionStack = [];
                State.loopCounters.clear();
                State.stats = {
                    commandsExecuted: 0,
                    startTime: Date.now(),
                    cellsPainted: 0,
                    loopsCompleted: 0,
                    conditionsChecked: 0
                };
                State.stepCount = 0;
                
                updateStatus('running', '–ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...');
                document.getElementById('btn-stop').disabled = false;
                document.getElementById('btn-run').disabled = true;
                
                // –ò—â–µ–º –Ω–∞—á–∞–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã
                let startIndex = State.programLines.findIndex(line => line.includes('–Ω–∞—á'));
                if (startIndex !== -1) {
                    State.currentLine = startIndex + 1;
                }
            }
            
            // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
            if (State.currentLine >= State.programLines.length) {
                State.stats.executionTime = (Date.now() - State.stats.startTime) / 1000;
                updateStatus('success', `‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${State.stats.executionTime.toFixed(1)}—Å`);
                State.isRunning = false;
                State.isStepping = false;
                document.getElementById('btn-stop').disabled = true;
                document.getElementById('btn-run').disabled = false;
                return;
            }
            
            try {
                await executeCurrentLine();
                State.stepCount++;
                updateDebugInfo();
                updateLineNumbers();
            } catch (error) {
                updateStatus('error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                State.isRunning = false;
                State.isStepping = false;
                document.getElementById('btn-stop').disabled = true;
                document.getElementById('btn-run').disabled = false;
            }
            
            updateStats();
        }

        function validateProgram() {
            const code = document.getElementById('algorithm-code').value;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
            const required = ['–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç', '–∞–ª–≥', '–Ω–∞—á', '–∫–æ–Ω'];
            for (const req of required) {
                if (!code.includes(req)) {
                    updateStatus('error', `‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: "${req}"`);
                    return false;
                }
            }
            
            return true;
        }

        async function executeCurrentLine() {
            if (State.currentLine >= State.programLines.length) return;
            
            const line = State.programLines[State.currentLine];
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            if (line === '' || line.startsWith('!')) {
                State.currentLine++;
                return;
            }
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            if (line.includes('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å') || line.includes('–∞–ª–≥') || line.includes('–Ω–∞—á') || line.includes('–∫–æ–Ω')) {
                State.currentLine++;
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É
            try {
                if (line.startsWith('–Ω—Ü')) {
                    await handleLoopStart(line);
                } else if (line === '–∫—Ü') {
                    await handleLoopEnd();
                } else if (line.startsWith('–µ—Å–ª–∏')) {
                    await handleConditionStart(line);
                } else if (line === '–≤—Å–µ') {
                    // –ü—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —É—Å–ª–æ–≤–∏—è
                    State.executionStack = State.executionStack.filter(item => item.type !== 'condition');
                    State.currentLine++;
                } else if (line === '–∏–Ω–∞—á–µ') {
                    State.currentLine++;
                } else {
                    await executeCommand(line);
                    State.stats.commandsExecuted++;
                    State.currentLine++;
                }
            } catch (error) {
                throw new Error(`–°—Ç—Ä–æ–∫–∞ ${State.currentLine + 1}: ${error.message}`);
            }
            
            // –ê–Ω–∏–º–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –∫–ª–µ—Ç–∫—É
            const currentCell = document.querySelector(`.cell[data-x="${State.robot.x}"][data-y="${State.robot.y}"]`);
            if (currentCell) {
                currentCell.classList.add('executed');
                setTimeout(() => {
                    currentCell.classList.remove('executed');
                }, 300);
            }
            
            updateFieldDisplay();
        }

        async function executeCommand(command) {
            const cmd = command.trim();
            
            switch(cmd) {
                case '–≤–≤–µ—Ä—Ö':
                    if (!canMove('up')) throw new Error('–ù–µ –º–æ–≥—É –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–≤–µ—Ä—Ö');
                    moveRobot('up');
                    break;
                    
                case '–≤–Ω–∏–∑':
                    if (!canMove('down')) throw new Error('–ù–µ –º–æ–≥—É –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–Ω–∏–∑');
                    moveRobot('down');
                    break;
                    
                case '–≤–ª–µ–≤–æ':
                    if (!canMove('left')) throw new Error('–ù–µ –º–æ–≥—É –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ª–µ–≤–æ');
                    moveRobot('left');
                    break;
                    
                case '–≤–ø—Ä–∞–≤–æ':
                    if (!canMove('right')) throw new Error('–ù–µ –º–æ–≥—É –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ø—Ä–∞–≤–æ');
                    moveRobot('right');
                    break;
                    
                case '–∑–∞–∫—Ä–∞—Å–∏—Ç—å':
                    State.field[State.robot.y][State.robot.x].painted = true;
                    State.stats.cellsPainted++;
                    break;
                    
                case '–æ—Å–≤–æ–±–æ–¥–∏—Ç—å':
                    State.field[State.robot.y][State.robot.x].painted = false;
                    State.stats.cellsPainted = Math.max(0, State.stats.cellsPainted - 1);
                    break;
                    
                default:
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
                    console.log(`–ü—Ä–æ–ø—É—â–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: ${cmd}`);
                    break;
            }
            
            await delay(100);
        }

        async function handleLoopStart(line) {
            State.stats.loopsCompleted++;
            
            if (line.includes('–ø–æ–∫–∞')) {
                // –¶–∏–∫–ª "–ø–æ–∫–∞"
                let condition = '';
                if (line.includes('—Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ')) condition = 'right';
                else if (line.includes('—Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ')) condition = 'left';
                else if (line.includes('—Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ')) condition = 'up';
                else if (line.includes('—Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ')) condition = 'down';
                else if (line.includes('–ù–ï –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞')) condition = 'not_painted';
                else if (line.includes('–∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞')) condition = 'painted';
                
                let conditionMet = false;
                if (condition === 'right') conditionMet = canMove('right');
                else if (condition === 'left') conditionMet = canMove('left');
                else if (condition === 'up') conditionMet = canMove('up');
                else if (condition === 'down') conditionMet = canMove('down');
                else if (condition === 'painted') conditionMet = State.field[State.robot.y][State.robot.x].painted;
                else if (condition === 'not_painted') conditionMet = !State.field[State.robot.y][State.robot.x].painted;
                
                if (conditionMet) {
                    State.executionStack.push({
                        type: 'loop',
                        startLine: State.currentLine,
                        condition: condition
                    });
                    State.currentLine++;
                } else {
                    skipToLoopEnd();
                }
            } else if (line.includes('—Ä–∞–∑')) {
                // –¶–∏–∫–ª —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
                const match = line.match(/–Ω—Ü\s+(\d+)\s+—Ä–∞–∑/);
                if (match) {
                    const count = parseInt(match[1]);
                    
                    State.loopCounters.set(State.currentLine, {
                        count: count,
                        current: 1
                    });
                    
                    State.executionStack.push({
                        type: 'loop',
                        startLine: State.currentLine,
                        maxCount: count
                    });
                    State.currentLine++;
                }
            }
        }

        async function handleLoopEnd() {
            if (State.executionStack.length === 0) {
                return;
            }
            
            const loop = State.executionStack[State.executionStack.length - 1];
            
            if (loop.type === 'loop') {
                if (loop.maxCount) {
                    // –¶–∏–∫–ª —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
                    const loopState = State.loopCounters.get(loop.startLine);
                    
                    if (loopState.current < loopState.count) {
                        // –ï—â–µ –µ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
                        loopState.current++;
                        State.currentLine = loop.startLine + 1;
                    } else {
                        // –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω
                        State.loopCounters.delete(loop.startLine);
                        State.executionStack.pop();
                        State.currentLine++;
                    }
                } else {
                    // –¶–∏–∫–ª "–ø–æ–∫–∞"
                    let conditionMet = false;
                    if (loop.condition === 'right') conditionMet = canMove('right');
                    else if (loop.condition === 'left') conditionMet = canMove('left');
                    else if (loop.condition === 'up') conditionMet = canMove('up');
                    else if (loop.condition === 'down') conditionMet = canMove('down');
                    else if (loop.condition === 'painted') conditionMet = State.field[State.robot.y][State.robot.x].painted;
                    else if (loop.condition === 'not_painted') conditionMet = !State.field[State.robot.y][State.robot.x].painted;
                    
                    if (conditionMet) {
                        // –£—Å–ª–æ–≤–∏–µ –µ—â–µ –∏—Å—Ç–∏–Ω–Ω–æ - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ü–∏–∫–ª
                        State.currentLine = loop.startLine + 1;
                    } else {
                        // –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω
                        State.executionStack.pop();
                        State.currentLine++;
                    }
                }
            }
        }

        async function handleConditionStart(line) {
            State.stats.conditionsChecked++;
            
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
            let conditionMet = false;
            
            if (line.includes('—Å–ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ') && line.includes('—Ç–æ')) {
                conditionMet = canMove('right');
            } else if (line.includes('—Å–ª–µ–≤–∞ —Å–≤–æ–±–æ–¥–Ω–æ') && line.includes('—Ç–æ')) {
                conditionMet = canMove('left');
            } else if (line.includes('—Å–≤–µ—Ä—Ö—É —Å–≤–æ–±–æ–¥–Ω–æ') && line.includes('—Ç–æ')) {
                conditionMet = canMove('up');
            } else if (line.includes('—Å–Ω–∏–∑—É —Å–≤–æ–±–æ–¥–Ω–æ') && line.includes('—Ç–æ')) {
                conditionMet = canMove('down');
            } else if (line.includes('–∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞') && line.includes('—Ç–æ')) {
                conditionMet = State.field[State.robot.y][State.robot.x].painted;
            } else if (line.includes('–ù–ï –∫–ª–µ—Ç–∫–∞ –∑–∞–∫—Ä–∞—à–µ–Ω–∞') && line.includes('—Ç–æ')) {
                conditionMet = !State.field[State.robot.y][State.robot.x].painted;
            }
            
            if (conditionMet) {
                State.executionStack.push({
                    type: 'condition',
                    startLine: State.currentLine
                });
                State.currentLine++;
            } else {
                skipToConditionElseOrEnd();
            }
        }

        function skipToConditionElseOrEnd() {
            let depth = 0;
            
            for (let i = State.currentLine + 1; i < State.programLines.length; i++) {
                const line = State.programLines[i];
                
                if (line.startsWith('–µ—Å–ª–∏')) {
                    depth++;
                } else if (line === '–≤—Å–µ' && depth === 0) {
                    State.currentLine = i + 1;
                    return;
                } else if (line === '–≤—Å–µ') {
                    depth--;
                } else if (line === '–∏–Ω–∞—á–µ' && depth === 0) {
                    State.currentLine = i + 1;
                    return;
                }
            }
            
            State.currentLine = State.programLines.length;
        }

        function skipToLoopEnd() {
            let depth = 0;
            
            for (let i = State.currentLine + 1; i < State.programLines.length; i++) {
                const line = State.programLines[i];
                
                if (line.startsWith('–Ω—Ü')) {
                    depth++;
                } else if (line === '–∫—Ü' && depth === 0) {
                    State.currentLine = i + 1;
                    return;
                } else if (line === '–∫—Ü') {
                    depth--;
                }
            }
            
            State.currentLine = State.programLines.length;
        }

        function canMove(direction) {
            let x = State.robot.x;
            let y = State.robot.y;
            
            switch(direction) {
                case 'up': y--; break;
                case 'down': y++; break;
                case 'left': x--; break;
                case 'right': x++; break;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
            if (x < 0 || x >= State.fieldWidth || y < 0 || y >= State.fieldHeight) {
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–Ω—ã
            return !State.field[y][x].wall;
        }

        function moveRobot(direction) {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–∑–∏—Ü–∏—é
            State.field[State.robot.y][State.robot.x].robot = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
            State.robot.direction = direction;
            switch(direction) {
                case 'up': State.robot.y--; break;
                case 'down': State.robot.y++; break;
                case 'left': State.robot.x--; break;
                case 'right': State.robot.x++; break;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
            State.field[State.robot.y][State.robot.x].robot = true;
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function updateStatus(state, message) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            
            dot.className = 'status-dot ' + state;
            text.textContent = message;
        }

        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.textContent = `–°–æ—Å—Ç–æ—è–Ω–∏–µ: ${State.isRunning ? '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ' : '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'} | –®–∞–≥: ${State.stepCount} | –¶–∏–∫–ª–æ–≤: ${State.stats.loopsCompleted}`;
        }

        function updateStats() {
            // –ü–æ–∑–∏—Ü–∏—è —Ä–æ–±–æ—Ç–∞
            document.getElementById('robot-position').textContent = 
                `(${State.robot.x},${State.robot.y})`;
            
            // –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∫–æ–º–∞–Ω–¥
            document.getElementById('commands-executed').textContent = 
                State.stats.commandsExecuted;
            
            // –ó–∞–∫—Ä–∞—à–µ–Ω–æ –∫–ª–µ—Ç–æ–∫
            let paintedCount = 0;
            for (let y = 0; y < State.fieldHeight; y++) {
                for (let x = 0; x < State.fieldWidth; x++) {
                    if (State.field[y][x].painted) paintedCount++;
                }
            }
            document.getElementById('cells-painted').textContent = paintedCount;
            
            // –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            if (State.stats.startTime && State.isRunning) {
                const time = (Date.now() - State.stats.startTime) / 1000;
                document.getElementById('execution-time').textContent = 
                    `${time.toFixed(1)}—Å`;
            }
            
            // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞
            document.getElementById('current-line').textContent = 
                State.currentLine + 1;
        }

        function createTestField() {
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            for (let y = 0; y < State.fieldHeight; y++) {
                for (let x = 0; x < State.fieldWidth; x++) {
                    State.field[y][x].wall = false;
                    State.field[y][x].painted = false;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
            for (let x = 0; x < State.fieldWidth; x++) {
                State.field[0][x].wall = true;
                State.field[State.fieldHeight-1][x].wall = true;
            }
            for (let y = 0; y < State.fieldHeight; y++) {
                State.field[y][0].wall = true;
                State.field[y][State.fieldWidth-1].wall = true;
            }
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            createSimpleMaze();
            
            placeRobot(9, 7, 'right');
            updateFieldDisplay();
            updateStats();
        }

        function createSimpleMaze() {
            // –ü—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—É—Ç–µ–º
            const walls = [
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ç–µ–Ω—ã
                [5,1], [5,2], [5,3], [5,4], [5,5], [5,6], [5,8], [5,9], [5,10], [5,11], [5,12], [5,13],
                [10,1], [10,2], [10,3], [10,4], [10,5], [10,6], [10,7], [10,8], [10,9], [10,10], [10,11], [10,12],
                [15,2], [15,3], [15,4], [15,5], [15,6], [15,7], [15,8], [15,9], [15,10], [15,11], [15,12], [15,13],
                
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–µ–Ω—ã
                [3,5], [4,5], [6,5], [7,5], [8,5], [9,5],
                [11,5], [12,5], [13,5], [14,5], [16,5], [17,5],
                [7,10], [8,10], [9,10], [11,10], [12,10], [13,10]
            ];
            
            walls.forEach(([x, y]) => {
                if (x < State.fieldWidth && y < State.fieldHeight) {
                    State.field[y][x].wall = true;
                }
            });
        }

        function createComplexMaze() {
            // –°–ª–æ–∂–Ω—ã–π –ª–∞–±–∏—Ä–∏–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
            for (let y = 0; y < State.fieldHeight; y++) {
                for (let x = 0; x < State.fieldWidth; x++) {
                    const isBorder = (x === 0 || x === State.fieldWidth-1 || y === 0 || y === State.fieldHeight-1);
                    
                    // –°–æ–∑–¥–∞–µ–º –ø–ª–æ—Ç–Ω—ã–π –ª–∞–±–∏—Ä–∏–Ω—Ç —Å –ø—Ä–æ—Ö–æ–¥–∞–º–∏
                    let isWall = false;
                    if (!isBorder) {
                        // –°–ª—É—á–∞–π–Ω—ã–µ —Å—Ç–µ–Ω—ã —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
                        const pattern1 = (x % 3 === 0 && y % 2 === 0);
                        const pattern2 = (x % 4 === 0 && y % 3 !== 0);
                        const pattern3 = (x > 5 && x < 15 && y > 3 && y < 11 && Math.random() < 0.4);
                        isWall = pattern1 || pattern2 || pattern3;
                    }
                    
                    State.field[y][x].wall = isBorder || isWall;
                    State.field[y][x].painted = false;
                }
            }
            
            // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ö–æ–¥ –¥–ª—è —Ä–æ–±–æ—Ç–∞
            for (let i = 1; i < 8; i++) {
                State.field[7][i].wall = false;
                State.field[i][10].wall = false;
            }
            
            placeRobot(9, 7, 'right');
            updateFieldDisplay();
            updateStats();
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function initApp() {
            initField();
            initEditor();
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∞–∫—Ä–æ—Å–æ–≤
            document.getElementById('apply-macro').addEventListener('click', () => {
                const macroSelect = document.getElementById('macro-select');
                const macroName = macroSelect.value;
                
                if (macroName && MACROS[macroName]) {
                    document.getElementById('algorithm-code').value = MACROS[macroName];
                    updateLineNumbers();
                    updateStatus('success', `–ü—Ä–∏–º–µ–Ω—ë–Ω –º–∞–∫—Ä–æ—Å: ${macroSelect.options[macroSelect.selectedIndex].text}`);
                }
            });
            
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–º
            document.querySelectorAll('.field-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.id) {
                        switch(this.id) {
                            case 'btn-add-walls':
                                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç–µ–Ω—ã
                                for (let y = 1; y < State.fieldHeight-1; y++) {
                                    for (let x = 1; x < State.fieldWidth-1; x++) {
                                        if (!State.field[y][x].robot && Math.random() < 0.25) {
                                            State.field[y][x].wall = true;
                                        }
                                    }
                                }
                                break;
                                
                            case 'btn-clear-all':
                                // –û—á–∏—â–∞–µ–º –≤—Å—ë
                                for (let y = 0; y < State.fieldHeight; y++) {
                                    for (let x = 0; x < State.fieldWidth; x++) {
                                        State.field[y][x].wall = false;
                                        State.field[y][x].painted = false;
                                    }
                                }
                                placeRobot(9, 7, 'right');
                                break;
                                
                            case 'btn-maze':
                                createComplexMaze();
                                updateStatus('info', '–°–æ–∑–¥–∞–Ω —Å–ª–æ–∂–Ω—ã–π –ª–∞–±–∏—Ä–∏–Ω—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–∫—Ä–æ—Å—ã "–£–º–Ω—ã–π –ø–æ–∏—Å–∫" –∏–ª–∏ "–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∞–≤–æ–π —Ä—É–∫–∏"');
                                break;
                                
                            case 'btn-test-field':
                                createTestField();
                                updateStatus('info', '–°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –º–∞–∫—Ä–æ—Å–æ–≤');
                                break;
                        }
                    } else {
                        // –ö–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–∞
                        document.querySelectorAll('.field-btn').forEach(b => 
                            b.classList.remove('active'));
                        this.classList.add('active');
                        State.fieldMode = this.dataset.mode;
                    }
                    
                    updateFieldDisplay();
                    updateStats();
                });
            });
            
            // –ö–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            document.getElementById('btn-run').addEventListener('click', executeProgram);
            
            document.getElementById('btn-step').addEventListener('click', async () => {
                await executeStep();
            });
            
            document.getElementById('btn-stop').addEventListener('click', () => {
                State.isRunning = false;
                State.isStepping = false;
                updateStatus('stopped', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                document.getElementById('btn-stop').disabled = true;
                document.getElementById('btn-run').disabled = false;
                document.getElementById('btn-step').disabled = false;
            });
            
            document.getElementById('btn-reset').addEventListener('click', () => {
                State.isRunning = false;
                State.isStepping = false;
                State.currentLine = 0;
                State.stepCount = 0;
                placeRobot(9, 7, 'right');
                updateFieldDisplay();
                updateLineNumbers();
                updateStats();
                updateDebugInfo();
                updateStatus('success', '–†–æ–±–æ—Ç —Å–±—Ä–æ—à–µ–Ω –≤ –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é');
                document.getElementById('btn-stop').disabled = true;
                document.getElementById('btn-run').disabled = false;
                document.getElementById('btn-step').disabled = false;
            });
            
            document.getElementById('btn-clear-code').addEventListener('click', () => {
                document.getElementById('algorithm-code').value = 
                    `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–æ–±–æ—Ç
–∞–ª–≥ –û—Å–Ω–æ–≤–Ω–∞—è–ü—Ä–æ–≥—Ä–∞–º–º–∞
–Ω–∞—á
  ! –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–ª–≥–æ—Ä–∏—Ç–º –∑–¥–µ—Å—å
–∫–æ–Ω`;
                updateLineNumbers();
                updateStatus('success', '–ö–æ–¥ –æ—á–∏—â–µ–Ω');
            });
            
            document.getElementById('btn-save-code').addEventListener('click', () => {
                const code = document.getElementById('algorithm-code').value;
                localStorage.setItem('robot-program', code);
                updateStatus('success', '–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ localStorage');
            });
            
            document.getElementById('btn-validate').addEventListener('click', () => {
                if (validateProgram()) {
                    updateStatus('success', '‚úì –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞');
                }
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
            const savedCode = localStorage.getItem('robot-program');
            if (savedCode) {
                document.getElementById('algorithm-code').value = savedCode;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
            updateStatus('running', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ...');
            updateStats();
            updateDebugInfo();
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>